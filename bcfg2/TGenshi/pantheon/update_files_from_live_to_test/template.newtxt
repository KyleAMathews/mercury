#!/bin/bash

# exit on any error or any pipeline command error
set -e
set -o pipefail

. /etc/pantheon/update_scripts_config

echo "Starting the update_files_from_live_to_test script"

# --headless assumes this script is not being run by hand (but rather in hudson or through another script)                                                                                                     
if [[ "--headless" != $$$$1 ]]; then
    echo "CONFIRM: update files from $$LIVE_WEBROOT (live) to $$TEST_WEBROOT (test) (y/n)"

    read ANSWER
    echo ""
    if [[ $${ANSWER} != "y" ]]; then
	echo "Cancelling....."
	exit 1
    fi
    echo "Creating a log of the output of this script at /etc/pantheon/logs/update_files_from_live_to_test.log"
    exec &> /etc/pantheon/logs/update_files_from_live_to_test.log
fi

echo "*Updating test files*"

rsync -av $$LIVE_WEBROOT/sites/all/files/ $$TEST_WEBROOT/sites/all/files/

echo "*test files updated*"
